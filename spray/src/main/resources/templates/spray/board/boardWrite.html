<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ·ğŸ·ğŸ·SprayğŸ·ğŸ·ğŸ·</title>
    <meta name="_csrf"        content="{{_csrf.token}}"     />
    <meta name="_csrf_header" content="{{_csrf.headerName}}"/>
    <link rel="stylesheet" href="/css/spray/nav.css"/>
    <link rel="stylesheet" href="/css/spray/boardFrontContent.css"/> 
    {{>spray/layout/header}}
    <script src="/js/spray/vue/boardWriteInnerVue.js"></script>
    <script src="/js/spray/cosmeticList/cosmetics.js"></script>
    <style>   
        .autocomplete-items div { padding: 10px; cursor: pointer;   }
        .autocomplete-active { background-color: #f3dbf2 !important; color: #ffffff; } 
    </style>

</head>
<body onload="init()">
{{>spray/nav/menu}} 
<div id="listView">     
    <cosmetic-view></cosmetic-view>    
</div>
<script>   

    // í’ˆëª© ìë™ì™„ì„±
    let autocomplete = (
   function () {
        
    let _inp = null;
    let _arr = [];
    let _currentFocus;

    let _setAutocomplete = function (inp, arr) {
        // autocompleteí•  ë°°ì—´
        _arr = arr;

        // ê¸°ì¡´ì˜ input ê°’ê³¼ ê°™ì§€ ì•Šë‹¤ë©´, ë¦¬ìŠ¤ë„ˆ í•´ì œ
        if (_inp === inp) {
            return;
        }
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆí•´ì œ
        _removeListener();

        // ìƒˆë¡œìš´ input ì˜ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€.
        _inp = inp;
        _inp.addEventListener("input", inputEvent);
        _inp.addEventListener("keydown", keydownEvent);
    }

    let inputEvent = function (e) {
        var a, b, i, val = this.value;

        // ì´ì „ ìƒì„±ëœ div ì œê±° 
        closeAllLists();

        // ìš”ì†Œ í™•ì¸
        if (!val) {
            if(typeof cos !== "undefined")
            {
                cos.remove();
            }

            return false;
        }

        // í˜„ì¬ì˜ í¬ì»¤ìŠ¤ì˜ ìœ„ì¹˜ëŠ” ì—†ìŒ.
        _currentFocus = -1;

        // autocompletì—ì„œ í•­ëª©ì„ ë³´ì—¬ì¤„ div ìƒì„±
        a = document.createElement("DIV");
        // 
        a.setAttribute("id", this.id + "autocomplete-list");
        // css ì ìš© 
        a.setAttribute("class", "autocomplete-items");

        if(typeof cos !== "undefined")
        {
            cos.remove();
        }        

        cos = document.createElement("IMG");                
        cos.setAttribute("style", "display: none;");

        // input ì•„ë˜ì˜ div ë¶™ì´ê¸°.
        this.parentNode.appendChild(a);
        this.parentNode.appendChild(cos);

        // autocompletí•  ìš”ì†Œ ì°¾ê¸°
        for (i = 0; i < _arr.length; i++) {
            // ë°°ì—´ì˜ ìš”ì†Œë¥¼ í˜„ì¬ inputì˜ valueì˜ ê°’ë§Œí¼ ìë¥¸ í›„, ê°™ìœ¼ë©´ ì¶”ê°€í•œë‹¤.
            if (_arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                b = document.createElement("DIV");
                // valueì˜ ê°’ ë§Œí¼ êµµê²Œ í‘œì‹œ 
                b.innerHTML = "<strong>" + _arr[i].substr(0, val.length) + "</strong>";
                b.innerHTML += _arr[i].substr(val.length);
                b.innerHTML += "<input type='hidden' value='" + _arr[i] + "'>";

                // ìƒì„±ëœ divì—ì„œ ì´ë²¤íŠ¸ ë°œìƒì‹œ hiddenìœ¼ë¡œ ìƒì„±ëœ inputì•ˆì˜ valueì˜ ê°’ì„ autocompleteí•  ìš”ì†Œì— ë„£ê¸°
                b.addEventListener("click", function (e) {
                    _inp.value = this.getElementsByTagName("input")[0].value;
                    
                    try {
                        let d = _.find(animalImg, {'product': _inp.value}); 
                        cos.setAttribute("src", d.img);
                        cos.setAttribute("style", "display: unset;"); 
                    }
                    catch(err) {
                        console.log(err.message); 
                    }
                    finally {
                        closeAllLists();
                    }                    
                });

                // autocomplete ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶™ì´ê¸°.
                a.appendChild(b);
            }
        }
    }

    let keydownEvent = function (e) {
        var x = document.getElementById(this.id + "autocomplete-list");
        
        if (x) {
            // íƒœê·¸ ë„¤ì„ì„ ê°€ì§€ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ì˜ ìœ ìš”í•œ html ì»¬ë ‰ì…˜ì„ ë°˜í™˜.
            // divì˜ ê°’ì„ htmlCollectionì˜ ê°’ìœ¼ë¡œ ë°›ì•„ì˜´.
            x = x.getElementsByTagName("div");
        }

        if (e.keyCode == 40) {
            // down
            // í˜„ì¬ìœ„ì¹˜ ì¦ê°€
            _currentFocus++;
            // í˜„ì¬ìœ„ì¹˜ì˜ í¬ì»¤ìŠ¤ ë‚˜íƒ€ë‚´ê¸°
            addActive(x);
        } else if (e.keyCode == 38) {
            // up
            // í˜„ì¬ìœ„ì¹˜ ê°ì†Œ
            _currentFocus--;
            // í˜„ì¬ìœ„ì¹˜ì˜ í¬ì»¤ìŠ¤ ë‚˜íƒ€ë‚´ê¸°
            addActive(x);
        } else if (e.keyCode == 13) {
            // enter
            e.preventDefault();
            // í˜„ì¬ìœ„ì¹˜ê°€ ì•„ì´í…œ ì„ íƒì°½ë‚´ì— ìˆëŠ” ê²½ìš°
            if (_currentFocus > -1) {
                // í˜„ì¬ ìœ„ì¹˜ì˜ ê°’ í´ë¦­
                if (x) x[_currentFocus].click();
            }
        } else if (e.keyCode == 8 || e.keyCode == 46) {
            
            if(typeof cos !== "undefined")
            {
                cos.remove();
            }
        }
    }
 
    let addActive = function (x) {
        if (!x) return false;
        removeActive(x);
        if (_currentFocus >= x.length) _currentFocus = 0;
        if (_currentFocus < 0) _currentFocus = (x.length - 1);
        x[_currentFocus].classList.add("autocomplete-active");
    }

    let removeActive = function (x) {
        for (var i = 0; i < x.length; i++) {
            x[i].classList.remove("autocomplete-active");
        }
    }

    let closeAllLists = function (elmnt) {
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
            if (elmnt != x[i] && elmnt != _inp) {
                x[i].parentNode.removeChild(x[i]);
            }
        }
    }

    let _removeListener = function () {
        if (_inp !== null) {
            console.log(_inp)
            _inp.removeEventListener("input", inputEvent, false);
            _inp.removeEventListener("keydown", keydownEvent, false);
        }
    }
    return {

        setAutocomplete: function (inp, arr) {
            _setAutocomplete(inp, arr);
        },
    }

    })();

    // autocomplete ë¶€ë¶„ì„ ìƒì„±
    window.onload = function () {
            autocomplete.setAutocomplete(document.getElementById("productName"), animal)
        }

    new Vue({
      el: '#listView', 
      component: 'cosmetic-view' 
    });  
    
   </script>
 
</body>
</html>
